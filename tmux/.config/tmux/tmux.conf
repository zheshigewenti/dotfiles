# -----------------------------------------------------------------------------
# 1. 基础全局设置
# -----------------------------------------------------------------------------
set -g prefix C-a             # 设置前缀键为 Ctrl-a (更易按)
unbind C-b                    # 解绑原有的 Ctrl-b
bind C-a send-prefix          # 确保 Ctrl-a 能正确发送前缀信号

set -g display-panes-time 10000  # 面板编号显示时间 (毫秒)
set -g mouse              on     # 开启鼠标支持 (滚动、点击、调大小)
set -g base-index         1      # 窗口编号从 1 开始
set -g renumber-windows   on     # 关闭窗口后自动重新排列编号
set -s escape-time        0      # 消除 Vim 中按 Esc 的延迟
set -sg repeat-time       300    # 快捷键连按超时间隔
set -g focus-events       on     # 开启焦点事件支持
set -g visual-activity    off    # 关闭窗口活动视觉提示

setw -g mode-keys         vi     # 复制模式使用 vi 快捷键
setw -g allow-rename      off    # 禁止程序自动重命名窗口
setw -g xterm-keys        on     # 开启 xterm 组合键支持

# 开启 UTF-8 编码
setw -q -g utf8           on
set -q -g status-utf8     on

# -----------------------------------------------------------------------------
# 2. 窗口与面板快捷键 (保持当前路径)
# -----------------------------------------------------------------------------
# 创建新窗口
bind c new-window -c "#{pane_current_path}"
# 水平拆分面板
bind '"' split-window -c "#{pane_current_path}"
# 垂直拆分面板
bind % split-window -h -c "#{pane_current_path}"

# -----------------------------------------------------------------------------
# 3. 状态栏美化 (极简现代风)
# -----------------------------------------------------------------------------
set -g status-position bottom      # 状态栏放在底部
set -g status-justify left         # 窗口列表左对齐
set -g status-style "bg=default"   # 背景透明 (适配终端背景色)

# 左侧：显示会话名称
set -g status-left "#[fg=blue,bold] 󰒓 #S #[fg=white,nobold] "

# 中间：窗口列表样式
set -g window-status-format "#[fg=brightblack] #I:#W "
set -g window-status-current-format "#[fg=magenta,bold] #I:#W "

# 右侧：显示时间日期
set -g status-right "#[fg=cyan]%H:%M #[fg=brightblack]| #[fg=green]%Y-%m-%d "

# -----------------------------------------------------------------------------
# 4. TPM 插件管理
# -----------------------------------------------------------------------------
# 设置插件安装路径
setenv -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'

# 插件列表
set -g @plugin 'tmux-plugins/tpm'                # 插件管理器
set -g @plugin 'tmux-plugins/tmux-pain-control'  # 面板导航 (h/j/k/l)
set -g @plugin 'tmux-plugins/tmux-resurrect'     # 会话保存与恢复
set -g @plugin 'tmux-plugins/tmux-yank'          # 更好的剪贴板集成

# -----------------------------------------------------------------------------
# 5. TPM 初始化与自动安装逻辑 (必须放最后)
# -----------------------------------------------------------------------------

# 如果没有 TPM 插件管理器，则自动安装
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# 初始化 TPM
run '~/.tmux/plugins/tpm/tpm'
